{% extends "base.html" %}

{% block title %}๐ต๏ธ Adivina Confesiones{% endblock %}

{% block content %}
<div class="container-futurista">
ย ย <h1 class="titulo-neon">๐ต๏ธ Adivina Confesiones</h1>
ย ย <a href="{{ url_for('jugar') }}" class="boton-futurista boton-menu">๐ฎ Volver a Juegos</a>

ย ย <div class="form-futurista">
ย ย ย ย <textarea id="texto" rows="3" placeholder="Escribe tu confesiรณn..." class="input-futurista"></textarea>
ย ย ย ย <button id="btnEnviar" class="boton-futurista boton-rosa">
ย ย ย ย ย ย โ Agregar Confesiรณn
ย ย ย ย </button>
ย ย </div>

ย ย <div id="listaConfesiones" class="lista-futurista">
ย ย ย ย {% for item in textos %}
ย ย ย ย <div class="confesion-card" data-id="{{ item._id }}">
ย ย ย ย ย ย <p class="user-info">{{ item.user }} ๐ต๏ธ</p>
ย ย ย ย ย ย <p class="confesion-text">{{ item.texto }}</p>
ย ย ย ย ย ย <small class="fecha-info">{{ item.fecha.strftime('%d/%m/%Y %H:%M') }}</small>

ย ย ย ย ย ย <div class="reacciones-futuristas">
ย ย ย ย ย ย ย ย <button class="btnReaccion emoji-btn" data-tipo="like">๐ {{ item.reacciones.like if item.reacciones else 0 }}</button>
ย ย ย ย ย ย ย ย <button class="btnReaccion emoji-btn" data-tipo="love">โค๏ธ {{ item.reacciones.love if item.reacciones else 0 }}</button>
ย ย ย ย ย ย ย ย <button class="btnReaccion emoji-btn" data-tipo="laugh">๐ {{ item.reacciones.laugh if item.reacciones else 0 }}</button>
ย ย ย ย ย ย ย ย <button class="btnReaccion emoji-btn" data-tipo="shock">๐ฑ {{ item.reacciones.shock if item.reacciones else 0 }}</button>
ย ย ย ย ย ย ย ย <button class="btnReaccion emoji-btn" data-tipo="dislike">๐ {{ item.reacciones.dislike if item.reacciones else 0 }}</button>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="comentarios-futurista">
ย ย ย ย ย ย ย ย <h4 class="comentarios-titulo">๐ฌ Comentarios</h4>
ย ย ย ย ย ย ย ย <div class="comentarios-lista">
ย ย ย ย ย ย ย ย ย ย {% if item.comentarios %}
ย ย ย ย ย ย ย ย ย ย {% for com in item.comentarios %}
ย ย ย ย ย ย ย ย ย ย <div class="comentario-item">
ย ย ย ย ย ย ย ย ย ย ย ย <strong class="comentario-user">{{ com.user }}</strong>: <span>{{ com.texto }}</span><br>
ย ย ย ย ย ย ย ย ย ย ย ย <small class="fecha-info">{{ com.fecha.strftime('%d/%m/%Y %H:%M') }}</small>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย {% endfor %}
ย ย ย ย ย ย ย ย ย ย {% else %}
ย ย ย ย ย ย ย ย ย ย <p class="comentarios-vacio">Sin comentarios aรบn</p>
ย ย ย ย ย ย ย ย ย ย {% endif %}
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="comentar-box">
ย ย ย ย ย ย ย ย <input type="text" class="inputComentario input-futurista" placeholder="Agrega un comentario..." maxlength="200">
ย ย ย ย ย ย ย ย <button class="btnAgregarComentario boton-futurista boton-rosa">Comentar</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย ย ย {% endfor %}
ย ย </div>
</div>

<script>
ย ย // Agregar confesiรณn
ย ย document.getElementById("btnEnviar").addEventListener("click", () => {
ย ย ย ย const texto = document.getElementById("texto").value.trim();
ย ย ย ย if (!texto) {
ย ย ย ย ย ย alert("Escribe algo para agregar");
ย ย ย ย ย ย return;
ย ย ย ย }

ย ย ย ย fetch("/adivina/agregar", {
ย ย ย ย ย ย method: "POST",
ย ย ย ย ย ย headers: {"Content-Type": "application/json"},
ย ย ย ย ย ย body: JSON.stringify({texto: texto})
ย ย ย ย })
ย ย ย ย .then(res => res.json())
ย ย ย ย .then(data => {
ย ย ย ย ย ย if (data.success) {
ย ย ย ย ย ย ย ย alert(data.message);
ย ย ย ย ย ย ย ย location.reload();
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย alert(data.message);
ย ย ย ย ย ย }
ย ย ย ย });
ย ย });

ย ย // Manejar reacciones
ย ย document.querySelectorAll(".btnReaccion").forEach(btn => {
ย ย ย ย btn.addEventListener("click", () => {
ย ย ย ย ย ย const confDiv = btn.closest(".confesion-card");
ย ย ย ย ย ย const confId = confDiv.getAttribute("data-id");
ย ย ย ย ย ย const tipo = btn.getAttribute("data-tipo");

ย ย ย ย ย ย fetch("/adivina/reaccionar", {
ย ย ย ย ย ย ย ย method: "POST",
ย ย ย ย ย ย ย ย headers: {"Content-Type": "application/json"},
ย ย ย ย ย ย ย ย body: JSON.stringify({confesionId: confId, tipo: tipo})
ย ย ย ย ย ย }).then(res => res.json())
ย ย ย ย ย ย .then(data => {
ย ย ย ย ย ย ย ย if(data.success){
ย ย ย ย ย ย ย ย ย ย let count = parseInt(btn.textContent.match(/\d+$/)[0]);
ย ย ย ย ย ย ย ย ย ย btn.textContent = btn.textContent.replace(/\d+$/, count + 1);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย alert(data.message);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย });
ย ย });

ย ย // Manejar agregar comentario
ย ย document.querySelectorAll(".btnAgregarComentario").forEach(btn => {
ย ย ย ย btn.addEventListener("click", () => {
ย ย ย ย ย ย const confDiv = btn.closest(".confesion-card");
ย ย ย ย ย ย const confId = confDiv.getAttribute("data-id");
ย ย ย ย ย ย const input = confDiv.querySelector(".inputComentario");
ย ย ย ย ย ย const texto = input.value.trim();

ย ย ย ย ย ย if(!texto){
ย ย ย ย ย ย ย ย alert("Escribe un comentario");
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย fetch("/adivina/comentar", {
ย ย ย ย ย ย ย ย method: "POST",
ย ย ย ย ย ย ย ย headers: {"Content-Type": "application/json"},
ย ย ย ย ย ย ย ย body: JSON.stringify({confesionId: confId, texto: texto})
ย ย ย ย ย ย }).then(res => res.json())
ย ย ย ย ย ย .then(data => {
ย ย ย ย ย ย ย ย if(data.success){
ย ย ย ย ย ย ย ย ย ย const comentariosDiv = confDiv.querySelector(".comentarios-lista");
ย ย ย ย ย ย ย ย ย ย const nuevoCom = document.createElement("div");
ย ย ย ย ย ย ย ย ย ย nuevoCom.className = "comentario-item";
ย ย ย ย ย ย ย ย ย ย nuevoCom.innerHTML = `<strong class="comentario-user">Tรบ</strong>: <span>${texto}</span><br><small class="fecha-info">Ahora mismo</small>`;
ย ย ย ย ย ย ย ย ย ย comentariosDiv.appendChild(nuevoCom);
ย ย ย ย ย ย ย ย ย ย input.value = "";
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย alert(data.message);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย });
ย ย });
</script>

<style>
ย ย /* Estilos generales y variables neรณn */
ย ย :root {
ย ย ย ย --color-neon-pink: #ff33cc;
ย ย ย ย --color-neon-purple: #9933ff;
ย ย ย ย --color-neon-aqua: #00ffff;
ย ย ย ย --color-text-light: #f0f0f0;
ย ย ย ย --color-bg-dark: #1a0033;
ย ย ย ย --color-bg-card-dark: #29004d;
ย ย }

ย ย body {
ย ย ย ย background: var(--color-bg-dark);
ย ย ย ย color: var(--color-text-light);
ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
ย ย }

ย ย .container-futurista {
ย ย ย ย max-width: 700px;
ย ย ย ย margin: auto;
ย ย ย ย padding: 20px;
ย ย ย ย text-align: center;
ย ย }

ย ย /* Tรญtulos y texto neรณn */
ย ย .titulo-neon {
ย ย ย ย text-align: center;
ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
ย ย ย ย color: var(--color-neon-aqua);
ย ย ย ย text-shadow: 0 0 10px var(--color-neon-aqua), 0 0 20px var(--color-neon-pink);
ย ย }

ย ย /* Botones y formularios */
ย ย .boton-futurista {
ย ย ย ย padding: 10px 20px;
ย ย ย ย border: none;
ย ย ย ย border-radius: 25px;
ย ย ย ย font-weight: bold;
ย ย ย ย text-transform: uppercase;
ย ย ย ย text-decoration: none;
ย ย ย ย box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
ย ย ย ย transition: transform 0.2s ease, background 0.2s ease;
ย ย ย ย cursor: pointer;
ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
ย ย ย ย color: white;
ย ย }

ย ย .boton-futurista:hover {
ย ย ย ย transform: translateY(-2px);
ย ย }

ย ย .boton-menu {
ย ย ย ย background: var(--color-neon-purple);
ย ย }

ย ย .boton-rosa {
ย ย ย ย background: var(--color-neon-pink);
ย ย ย ย box-shadow: 0 0 10px var(--color-neon-pink);
ย ย }

ย ย .form-futurista {
ย ย ย ย margin-top: 20px;
ย ย ย ย width: 100%;
ย ย ย ย max-width: 500px;
ย ย ย ย background: var(--color-bg-card-dark);
ย ย ย ย padding: 15px;
ย ย ย ย border-radius: 10px;
ย ย ย ย box-shadow: 0 0 15px var(--color-neon-aqua);
ย ย }

ย ย .input-futurista {
ย ย ย ย width: 100%;
ย ย ย ย padding: 10px;
ย ย ย ย border: 1px solid var(--color-neon-pink);
ย ย ย ย border-radius: 5px;
ย ย ย ย background: #330066;
ย ย ย ย color: #fff;
ย ย ย ย resize: none;
ย ย ย ย word-wrap: break-word;
ย ย ย ย margin-bottom: 10px;
ย ย }

ย ย /* Lista de confesiones */
ย ย .lista-futurista {
ย ย ย ย margin-top: 30px;
ย ย ย ย width: 100%;
ย ย ย ย max-width: 500px;
ย ย }

ย ย .confesion-card {
ย ย ย ย background: var(--color-bg-card-dark);
ย ย ย ย margin-bottom: 15px;
ย ย ย ย padding: 15px;
ย ย ย ย border-radius: 10px;
ย ย ย ย box-shadow: 0 0 10px var(--color-neon-purple);
ย ย ย ย border: 1px solid var(--color-neon-purple);
ย ย ย ย color: white;
ย ย }

ย ย .user-info {
ย ย ย ย color: var(--color-neon-aqua);
ย ย ย ย margin-bottom: 5px;
ย ย ย ย font-weight: bold;
ย ย }

ย ย .confesion-text {
ย ย ย ย word-wrap: break-word;
ย ย ย ย margin-bottom: 10px;
ย ย ย ย text-align: left;
ย ย }

ย ย .fecha-info {
ย ย ย ย color: #888;
ย ย ย ย font-size: 0.8em;
ย ย }

ย ย /* Reacciones */
ย ย .reacciones-futuristas {
ย ย ย ย margin-top: 10px;
ย ย ย ย display: flex;
ย ย ย ย gap: 8px;
ย ย ย ย justify-content: center;
ย ย ย ย flex-wrap: wrap;
ย ย }

ย ย .emoji-btn {
ย ย ย ย background: transparent;
ย ย ย ย border: 2px solid var(--color-neon-pink);
ย ย ย ย padding: 8px 12px;
ย ย ย ย border-radius: 50px;
ย ย ย ย cursor: pointer;
ย ย ย ย font-size: 16px;
ย ย ย ย color: var(--color-neon-pink);
ย ย ย ย transition: background 0.3s ease, color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
ย ย ย ย box-shadow: 0 0 5px var(--color-neon-pink);
ย ย }

ย ย .reacciones {
ย ย margin-top: 15px;
ย ย display: flex;
ย ย gap: 5px;
ย ย flex-wrap: wrap;
}
.reacciones .emoji-btn {
ย ย background: rgba(255, 255, 255, 0.1);
ย ย border: none;
ย ย padding: 8px 12px;
ย ย border-radius: 50px;
ย ย cursor: pointer;
ย ย font-size: 16px;
ย ย color: #fff;
ย ย transition: 0.2s;
}
.reacciones .emoji-btn:hover {
ย ย background: var(--color-neon-pink);
ย ย transform: scale(1.1);
}

</style>
{% endblock %}